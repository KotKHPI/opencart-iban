<div class="buttons">
  <div class="pull-right">
    <input type="button" value="{{ button_pay }}" id="button-confirm" class="btn btn-primary" data-loading-text="{{ text_loading }}" />
  </div>
</div>

<script type="text/javascript">
$('#button-confirm').on('click', function() {
  $.ajax({
    url: 'index.php?route=extension/payment/opencart_iban/confirm',
    dataType: 'json',
    beforeSend: function() {
      $('#button-confirm').button('loading');
    },
    complete: function() {
      $('#button-confirm').button('reset');
    },
    success: function(json) {
      if (json['redirect']) {
        location = json['redirect'];
        return;
      }

      if (json['form'] && json['form']['action'] && json['form']['fields']) {
        var form = document.createElement('form');
        form.method = 'POST';
        form.action = json['form']['action'];

        var fields = json['form']['fields'];

        for (var name in fields) {
          if (!fields.hasOwnProperty(name)) continue;

          var input = document.createElement('input');
          input.type = 'hidden';
          input.name = name;
          input.value = fields[name];
          form.appendChild(input);
        }

        document.body.appendChild(form);
        form.submit();
        return;
      }

      if (json['error']) {
        alert(json['error']);
      }
    },
    error: function(xhr, ajaxOptions, thrownError) {
      alert(thrownError + "\\r\\n" + xhr.statusText + "\\r\\n" + xhr.responseText);
    }
  });
});
</script>

