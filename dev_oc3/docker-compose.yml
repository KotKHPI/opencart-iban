services:
  db:
    image: mysql:8.0
    environment:
      MYSQL_DATABASE: ${DB_DATABASE:-opencart}
      MYSQL_USER: ${DB_USERNAME:-opencart}
      MYSQL_PASSWORD: ${DB_PASSWORD:-opencart}
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD:-opencart}
    command: --default-authentication-plugin=mysql_native_password
    volumes:
      - db_data:/var/lib/mysql

  opencart:
    build:
      context: ./docker/opencart
      args:
        OPENCART_VERSION: ${OPENCART_VERSION:-3.0.3.8}
    depends_on:
      - db
    environment:
      OPENCART_HTTP_SERVER: ${OPENCART_HTTP_SERVER:-http://localhost:8081/}
      OPENCART_USERNAME: ${OPENCART_USERNAME:-admin}
      OPENCART_PASSWORD: ${OPENCART_PASSWORD:-admin}
      OPENCART_ADMIN_EMAIL: ${OPENCART_ADMIN_EMAIL:-admin@example.com}
      OPENCART_LANGUAGE: ${OPENCART_LANGUAGE:-en-gb}

      DB_DRIVER: ${DB_DRIVER:-mysqli}
      DB_HOSTNAME: ${DB_HOSTNAME:-db}
      DB_USERNAME: ${DB_USERNAME:-opencart}
      DB_PASSWORD: ${DB_PASSWORD:-opencart}
      DB_DATABASE: ${DB_DATABASE:-opencart}
      DB_PORT: ${DB_PORT:-3306}
      DB_PREFIX: ${DB_PREFIX:-oc_}

      # Xdebug (Xdebug 3)
      # Enable with: XDEBUG_MODE=debug,develop
      XDEBUG_MODE: ${XDEBUG_MODE:-off}
      XDEBUG_CONFIG: client_host=${XDEBUG_CLIENT_HOST:-host.docker.internal} client_port=${XDEBUG_CLIENT_PORT:-9003}
      PHP_IDE_CONFIG: serverName=${PHP_IDE_SERVER_NAME:-opencart_oc3}
    ports:
      - ${OPENCART_PORT:-8081}:80
    extra_hosts:
      # For Linux hosts. On Docker Desktop (macOS/Windows) it already exists.
      - host.docker.internal:host-gateway
    volumes:
      - opencart_data:/var/www/html

volumes:
  db_data:
  opencart_data:
